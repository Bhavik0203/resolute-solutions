<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Commerce Dashboard - Resolute Solutions</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f3f3;
            color: #333;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #232f3e 0%, #37475a 100%);
            color: white;
            padding: 0.5rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header-top {
            background: #131921;
            padding: 0.5rem 0;
            font-size: 0.875rem;
        }

        .header-top .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header-main {
            padding: 1rem 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1rem;
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ff9900;
            text-decoration: none;
        }

        .search-bar {
            flex: 1;
            max-width: 600px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            outline: none;
        }

        .search-btn {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            background: #ff9900;
            border: none;
            padding: 0 1rem;
            border-radius: 0 4px 4px 0;
            cursor: pointer;
            color: white;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-action {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: white;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .header-action:hover {
            background-color: rgba(255,255,255,0.1);
        }

        .header-action i {
            font-size: 1.25rem;
            margin-bottom: 0.25rem;
        }

        .header-action span {
            font-size: 0.75rem;
        }

        .cart-count {
            background: #ff9900;
            color: white;
            border-radius: 50%;
            padding: 0.25rem 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            position: absolute;
            top: -0.25rem;
            right: -0.25rem;
        }

        /* Navigation */
        .nav {
            background: #232f3e;
            padding: 0.5rem 0;
        }

        .nav-list {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-item a {
            color: white;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        .nav-item a:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4rem 0;
            text-align: center;
            margin-bottom: 2rem;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.25rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .cta-button {
            background: #ff9900;
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: background-color 0.2s;
        }

        .cta-button:hover {
            background: #e68900;
        }

        /* Dashboard Cards */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .dashboard-card {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .dashboard-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.15);
        }

        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .card-icon {
            width: 3rem;
            height: 3rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
            font-size: 1.25rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: #333;
        }

        .card-content {
            color: #666;
            line-height: 1.6;
        }

        .card-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #eee;
        }

        .stat {
            text-align: center;
        }

        .stat-number {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
        }

        .stat-label {
            font-size: 0.875rem;
            color: #666;
        }

        /* Product Grid */
        .products-section {
            background: white;
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .view-all-btn {
            color: #0066cc;
            text-decoration: none;
            font-weight: 500;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .product-card {
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.2s, box-shadow 0.2s;
            background: white;
        }

        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(0,0,0,0.1);
        }

         .product-image {
             width: 100%;
             height: 200px;
             background: #f8f9fa;
             display: flex;
             align-items: center;
             justify-content: center;
             color: #666;
             font-size: 3rem;
             position: relative;
             cursor: pointer;
             overflow: hidden;
         }

         .product-overlay {
             position: absolute;
             top: 0;
             left: 0;
             right: 0;
             bottom: 0;
             background: rgba(0,0,0,0.7);
             display: flex;
             align-items: center;
             justify-content: center;
             opacity: 0;
             transition: opacity 0.3s;
         }

         .product-card:hover .product-overlay {
             opacity: 1;
         }

         .quick-view-btn {
             background: #ff9900;
             color: white;
             border: none;
             padding: 0.5rem 1rem;
             border-radius: 4px;
             cursor: pointer;
             font-weight: 600;
         }

         .product-actions {
             display: flex;
             gap: 0.5rem;
             margin-bottom: 0.5rem;
         }

         .wishlist-btn {
             background: transparent;
             border: 1px solid #ddd;
             padding: 0.5rem;
             border-radius: 4px;
             cursor: pointer;
             color: #666;
             transition: all 0.2s;
         }

         .wishlist-btn:hover {
             color: #e74c3c;
             border-color: #e74c3c;
         }

         .wishlist-btn.active {
             color: #e74c3c;
             border-color: #e74c3c;
         }

         .product-stock {
             font-size: 0.875rem;
             margin-top: 0.5rem;
         }

         .in-stock {
             color: #28a745;
         }

         .out-of-stock {
             color: #dc3545;
         }

        .product-info {
            padding: 1rem;
        }

        .product-name {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #333;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .product-price {
            font-size: 1.25rem;
            font-weight: 700;
            color: #b12704;
            margin-bottom: 0.5rem;
        }

        .product-rating {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .stars {
            color: #ff9900;
            margin-right: 0.5rem;
        }

        .rating-text {
            font-size: 0.875rem;
            color: #666;
        }

        .add-to-cart-btn {
            width: 100%;
            background: #ff9900;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .add-to-cart-btn:hover {
            background: #e68900;
        }

        /* Footer */
        .footer {
            background: #131921;
            color: white;
            padding: 3rem 0 1rem;
            margin-top: 4rem;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .footer-section h3 {
            margin-bottom: 1rem;
            color: #ff9900;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 0.5rem;
        }

        .footer-section ul li a {
            color: #ccc;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-section ul li a:hover {
            color: white;
        }

        .footer-bottom {
            border-top: 1px solid #37475a;
            padding-top: 1rem;
            text-align: center;
            color: #ccc;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 2rem;
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 1rem;
            top: 1rem;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .close:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }

        .form-group input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #ff9900;
        }

        .btn {
            background: #ff9900;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn:hover {
            background: #e68900;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* User Profile Section */
        .user-profile-section, .admin-profile-section {
            margin: 2rem 0;
        }

        .user-profile-card, .admin-profile-card {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .user-info, .admin-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar, .admin-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: white;
        }

        .admin-avatar {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }

        .user-details h3, .admin-details h3 {
            margin: 0 0 0.5rem 0;
            color: #333;
            font-size: 1.5rem;
        }

        .user-details p, .admin-details p {
            margin: 0 0 0.5rem 0;
            color: #666;
            font-size: 1rem;
        }

        .user-role, .admin-role {
            background: #e3f2fd;
            color: #1976d2;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .admin-role {
            background: #ffebee;
            color: #d32f2f;
        }

        .user-actions, .admin-actions {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: #007bff;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }

        /* Payment Modal Styles */
        .payment-summary {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }

        .payment-summary h3 {
            margin: 0 0 1rem 0;
            color: #333;
        }

        .payment-total {
            border-top: 2px solid #333;
            padding-top: 1rem;
            margin-top: 1rem;
            font-size: 1.25rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .payment-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 1.5rem;
        }

        .payment-actions .btn {
            min-width: 120px;
        }

        /* Card number formatting */
        #cardNumber {
            letter-spacing: 2px;
        }

        /* Expiry date formatting */
        #expiryDate {
            text-align: center;
        }

        /* CVV formatting */
        #cvv {
            text-align: center;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1rem;
            }

            .search-bar {
                order: 2;
                width: 100%;
            }

            .header-actions {
                order: 1;
                width: 100%;
                justify-content: space-around;
            }

            .nav-list {
                flex-wrap: wrap;
                gap: 1rem;
            }

            .hero h1 {
                font-size: 2rem;
            }

            .hero p {
                font-size: 1rem;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .user-profile-card, .admin-profile-card {
                flex-direction: column;
                text-align: center;
            }

            .user-actions, .admin-actions {
                justify-content: center;
            }
        }

        /* Loading Spinner */
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff9900;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert Messages */
        .alert {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .alert-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Payment Method Selection Styles */
        .payment-method-selection {
            margin: 2rem 0;
        }

        .payment-method-selection h3 {
            margin-bottom: 1rem;
            color: #333;
            font-size: 1.2rem;
        }

        .payment-methods {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .payment-method-option {
            display: flex;
            align-items: center;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background-color: #fff;
        }

        .payment-method-option:hover {
            border-color: #007bff;
            background-color: #f8f9fa;
        }

        .payment-method-option input[type="radio"] {
            margin-right: 1rem;
            transform: scale(1.2);
        }

        .payment-method-option input[type="radio"]:checked + label {
            color: #007bff;
            font-weight: 600;
        }

        .payment-method-option:has(input[type="radio"]:checked) {
            border-color: #007bff;
            background-color: #e3f2fd;
        }

        .payment-method-option label {
            display: flex;
            align-items: center;
            cursor: pointer;
            font-size: 1rem;
            color: #333;
            transition: color 0.3s ease;
        }

        .payment-method-option label i {
            margin-right: 0.5rem;
            font-size: 1.2rem;
            width: 20px;
        }

        .payment-method-info {
            margin-bottom: 2rem;
            padding: 1rem;
            background-color: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }

        .payment-method-info h3 {
            margin-bottom: 0.5rem;
            color: #333;
            font-size: 1.1rem;
        }

        .payment-method-info div {
            font-size: 1rem;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-top">
            <div class="container">
                <div class="header-top-left">
                    <span>Welcome to Resolute Solutions E-Commerce</span>
                </div>
                <div class="header-top-right">
                    <span id="user-greeting">Hello, Sign in</span>
                </div>
            </div>
        </div>
        
        <div class="header-main">
            <div class="container">
                <div class="header-content">
                    <a class="logo">
                        <i class="fas fa-shopping-bag"></i> ResoluteShop
                    </a>
                    
                    <div class="search-bar">
                        <input type="text" class="search-input" placeholder="Search for products..." id="searchInput">
                        <button class="search-btn" onclick="searchProducts()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    
                     <div class="header-actions">
                         <a class="header-action" onclick="showLoginModal()" id="accountBtn">
                             <i class="fas fa-user"></i>
                             <span>Account</span>
                         </a>
                         <a class="header-action" onclick="showWishlist()" style="position: relative;" id="wishlistBtn">
                             <i class="fas fa-heart"></i>
                             <span>Wishlist</span>
                             <span class="cart-count" id="wishlistCount">0</span>
                         </a>
                         <a class="header-action" onclick="showOrders()" id="ordersBtn">
                             <i class="fas fa-box"></i>
                             <span>Orders</span>
                         </a>
                         <a class="header-action" onclick="showCart()" style="position: relative;" id="cartBtn">
                             <i class="fas fa-shopping-cart"></i>
                             <span>Cart</span>
                             <span class="cart-count" id="cartCount">0</span>
                         </a>
                         <a class="header-action" onclick="showAdminPanel()" id="adminBtn" style="display: none;">
                             <i class="fas fa-cog"></i>
                             <span>Admin</span>
                         </a>
                     </div>
                </div>
            </div>
        </div>
        
        <nav class="nav">
            <div class="container">
                 <ul class="nav-list">
                     <li class="nav-item"><a onclick="showAllProducts()">All Products</a></li>
                     <li class="nav-item"><a onclick="filterByCategory('Electronics')">Electronics</a></li>
                     <li class="nav-item"><a onclick="filterByCategory('Clothing')">Clothing</a></li>
                     <li class="nav-item"><a onclick="filterByCategory('Books')">Books</a></li>
                     <li class="nav-item"><a onclick="filterByCategory('Home')">Home & Garden</a></li>
                     <li class="nav-item"><a onclick="document.getElementById('searchModal').style.display='block'">Advanced Search</a></li>
                     <li class="nav-item" id="adminNavItem" style="display: none;"><a onclick="showAdminPanel()">Admin Panel</a></li>
                 </ul>
            </div>
        </nav>
    </header>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Hero Section -->
            <section class="hero" id="heroSection">
                <h1>Welcome to Resolute Solutions</h1>
                <p>Your one-stop destination for quality products and exceptional service</p>
                <a class="cta-button" onclick="showAllProducts()">Start Shopping</a>
            </section>

            <!-- User Profile Section -->
            <section class="user-profile-section" id="userProfileSection" style="display: none;">
                <div class="user-profile-card">
                    <div class="user-info">
                        <div class="user-avatar">
                            <i class="fas fa-user-circle"></i>
                        </div>
                        <div class="user-details">
                            <h3 id="userName">Welcome, User!</h3>
                            <p id="userEmail">user@example.com</p>
                            <span class="user-role" id="userRole">USER</span>
                        </div>
                    </div>
                    <div class="user-actions">
                        <button class="btn btn-secondary" onclick="showOrders()">
                            <i class="fas fa-box"></i> My Orders
                        </button>
                        <button class="btn btn-secondary" onclick="showWishlist()">
                            <i class="fas fa-heart"></i> Wishlist
                        </button>
                        <button class="btn btn-secondary" onclick="showCart()">
                            <i class="fas fa-shopping-cart"></i> Cart
                        </button>
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </section>

            <!-- Admin Profile Section -->
            <section class="admin-profile-section" id="adminProfileSection" style="display: none;">
                <div class="admin-profile-card">
                    <div class="admin-info">
                        <div class="admin-avatar">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="admin-details">
                            <h3 id="adminName">Welcome, Admin!</h3>
                            <p id="adminEmail">admin@example.com</p>
                            <span class="admin-role">ADMINISTRATOR</span>
                        </div>
                    </div>
                    <div class="admin-actions">
                        <button class="btn btn-primary" onclick="showAdminPanel()">
                            <i class="fas fa-cog"></i> Admin Dashboard
                        </button>
                        <button class="btn btn-secondary" onclick="showOrders()">
                            <i class="fas fa-box"></i> All Orders
                        </button>
                        <button class="btn btn-secondary" onclick="showAllProducts()">
                            <i class="fas fa-shopping-bag"></i> Manage Products
                        </button>
                        <button class="btn btn-danger" onclick="logout()">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </section>

            <!-- Dashboard Overview -->
            <section class="dashboard-grid" id="dashboardGrid">
                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-shopping-bag"></i>
                        </div>
                        <div class="card-title">Total Products</div>
                    </div>
                    <div class="card-content">
                        Browse through our extensive collection of quality products
                    </div>
                    <div class="card-stats">
                        <div class="stat">
                            <div class="stat-number" id="totalProducts">0</div>
                            <div class="stat-label">Products</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="card-title">Active Users</div>
                    </div>
                    <div class="card-content">
                        Join thousands of satisfied customers
                    </div>
                    <div class="card-stats">
                        <div class="stat">
                            <div class="stat-number" id="totalUsers">0</div>
                            <div class="stat-label">Users</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="card-title">Total Orders</div>
                    </div>
                    <div class="card-content">
                        Track your orders and manage your purchases
                    </div>
                    <div class="card-stats">
                        <div class="stat">
                            <div class="stat-number" id="totalOrders">0</div>
                            <div class="stat-label">Orders</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card">
                    <div class="card-header">
                        <div class="card-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="card-title">Revenue</div>
                    </div>
                    <div class="card-content">
                        Total revenue generated from successful orders
                    </div>
                    <div class="card-stats">
                        <div class="stat">
                            <div class="stat-number" id="totalRevenue">$0</div>
                            <div class="stat-label">Revenue</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Products Section -->
            <section class="products-section" id="productsSection">
                <div class="section-header">
                    <h2 class="section-title">Featured Products</h2>
                    <a class="view-all-btn" onclick="showAllProducts()">View All</a>
                </div>
                <div class="loading" id="productsLoading">
                    <div class="spinner"></div>
                </div>
                <div class="products-grid" id="productsGrid">
                    <!-- Products will be loaded here -->
                </div>
            </section>
        </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Get to Know Us</h3>
                    <ul>
                        <li><a href="#">About Us</a></li>
                        <li><a href="#">Careers</a></li>
                        <li><a href="#">Press Releases</a></li>
                        <li><a href="#">Resolute Solutions Science</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Make Money with Us</h3>
                    <ul>
                        <li><a href="#">Sell products on ResoluteShop</a></li>
                        <li><a href="#">Sell on ResoluteShop Business</a></li>
                        <li><a href="#">Become an Affiliate</a></li>
                        <li><a href="#">Advertise Your Products</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Payment Products</h3>
                    <ul>
                        <li><a href="#">ResoluteShop Business Card</a></li>
                        <li><a href="#">Shop with Points</a></li>
                        <li><a href="#">Reload Your Balance</a></li>
                        <li><a href="#">Currency Converter</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Let Us Help You</h3>
                    <ul>
                        <li><a href="#">COVID-19 and ResoluteShop</a></li>
                        <li><a href="#">Your Account</a></li>
                        <li><a href="#">Your Orders</a></li>
                        <li><a href="#">Shipping Rates & Policies</a></li>
                        <li><a href="#">Returns & Replacements</a></li>
                        <li><a href="#">Help</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 Resolute Solutions. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('loginModal')">&times;</span>
            <h2>Sign In</h2>
            <div class="alert alert-success" id="loginSuccess"></div>
            <div class="alert alert-error" id="loginError"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn">Sign In</button>
            </form>
            <p style="margin-top: 1rem; text-align: center;">
                Don't have an account? <a onclick="showRegisterModal()">Sign up</a>
            </p>
        </div>
    </div>

    <!-- Register Modal -->
    <div id="registerModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('registerModal')">&times;</span>
            <h2>Create Account</h2>
            <div class="alert alert-success" id="registerSuccess"></div>
            <div class="alert alert-error" id="registerError"></div>
            <form id="registerForm">
                <div class="form-group">
                    <label for="registerName">Full Name</label>
                    <input type="text" id="registerName" required>
                </div>
                <div class="form-group">
                    <label for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" required>
                </div>
                <div class="form-group">
                    <label for="registerPassword">Password</label>
                    <input type="password" id="registerPassword" required>
                </div>
                <div class="form-group">
                    <label for="registerRole">Role</label>
                    <select id="registerRole" required>
                        <option value="">Select a role</option>
                        <option value="CUSTOMER">Customer</option>
                        <option value="ADMIN">Admin</option>
                        <option value="SELLER">Seller</option>
                    </select>
                </div>
                <button type="submit" class="btn">Create Account</button>
            </form>
            <p style="margin-top: 1rem; text-align: center;">
                Already have an account? <a onclick="showLoginModal()">Sign in</a>
            </p>
        </div>
    </div>

    <!-- Cart Modal -->
    <div id="cartModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('cartModal')">&times;</span>
            <h2>Shopping Cart</h2>
            <div id="cartContent">
                <div class="loading" id="cartLoading">
                    <div class="spinner"></div>
                </div>
                <div id="cartItems"></div>
            </div>
        </div>
    </div>

    <!-- Orders Modal -->
    <div id="ordersModal" class="modal">
        <div class="modal-content" style="max-width: 900px;">
            <span class="close" onclick="closeModal('ordersModal')">&times;</span>
            <h2>Order History</h2>
            <div id="ordersContent">
                <div class="loading" id="ordersLoading">
                    <div class="spinner"></div>
                </div>
                <div id="ordersList"></div>
            </div>
        </div>
    </div>

     <!-- Admin Panel Modal -->
     <div id="adminModal" class="modal">
         <div class="modal-content" style="max-width: 1000px;">
             <span class="close" onclick="closeModal('adminModal')">&times;</span>
             <h2>Admin Dashboard</h2>
             <div id="adminContent">
                 <div class="loading" id="adminLoading">
                     <div class="spinner"></div>
                 </div>
                 <div id="adminDashboard"></div>
             </div>
         </div>
     </div>

     <!-- Add Product Modal -->
     <div id="addProductModal" class="modal">
         <div class="modal-content" style="max-width: 600px;">
             <span class="close" onclick="closeModal('addProductModal')">&times;</span>
             <h2>Add New Product</h2>
             <form id="addProductForm" onsubmit="handleAddProduct(event)">
                 <div class="form-group">
                     <label for="productName">Product Name *</label>
                     <input type="text" id="productName" name="name" required>
                 </div>
                 <div class="form-group">
                     <label for="productDescription">Description *</label>
                     <textarea id="productDescription" name="description" rows="3" required></textarea>
                 </div>
                 <div class="form-group">
                     <label for="productPrice">Price *</label>
                     <input type="number" id="productPrice" name="price" step="0.01" min="0" required>
                 </div>
                 <div class="form-group">
                     <label for="productStock">Stock Quantity *</label>
                     <input type="number" id="productStock" name="stock" min="0" required>
                 </div>
                 <div class="form-group">
                     <label for="productCategory">Category *</label>
                     <select id="productCategory" name="category" required>
                         <option value="">Select Category</option>
                         <option value="Electronics">Electronics</option>
                         <option value="Clothing">Clothing</option>
                         <option value="Books">Books</option>
                         <option value="Home">Home & Garden</option>
                         <option value="Sports">Sports</option>
                         <option value="Beauty">Beauty</option>
                         <option value="Toys">Toys</option>
                     </select>
                 </div>
                 <div class="form-group">
                     <label for="productImageUrl">Image URL</label>
                     <input type="url" id="productImageUrl" name="imageUrl" placeholder="https://example.com/image.jpg">
                 </div>
                 <div class="form-group">
                     <label for="productBrand">Brand</label>
                     <input type="text" id="productBrand" name="brand">
                 </div>
                 <div class="form-group">
                     <label for="productWeight">Weight (kg)</label>
                     <input type="number" id="productWeight" name="weight" step="0.01" min="0">
                 </div>
                 <div class="form-group">
                     <label for="productDimensions">Dimensions (L x W x H in cm)</label>
                     <input type="text" id="productDimensions" name="dimensions" placeholder="e.g., 10 x 5 x 3">
                 </div>
                 <div class="form-actions">
                     <button type="button" class="btn btn-secondary" onclick="closeModal('addProductModal')">Cancel</button>
                     <button type="submit" class="btn btn-primary">Add Product</button>
                 </div>
             </form>
         </div>
     </div>

     <!-- Product Details Modal -->
     <div id="productModal" class="modal">
         <div class="modal-content" style="max-width: 800px;">
             <span class="close" onclick="closeModal('productModal')">&times;</span>
             <div id="productDetails">
                 <div class="loading" id="productLoading">
                     <div class="spinner"></div>
                 </div>
                 <div id="productContent"></div>
             </div>
         </div>
     </div>

     <!-- Advanced Search Modal -->
     <div id="searchModal" class="modal">
         <div class="modal-content" style="max-width: 600px;">
             <span class="close" onclick="closeModal('searchModal')">&times;</span>
             <h2>Advanced Search</h2>
             <form id="advancedSearchForm">
                 <div class="form-group">
                     <label for="searchTerm">Search Term</label>
                     <input type="text" id="searchTerm" placeholder="Enter product name or description">
                 </div>
                 <div class="form-group">
                     <label for="searchCategory">Category</label>
                     <select id="searchCategory">
                         <option value="">All Categories</option>
                         <option value="Electronics">Electronics</option>
                         <option value="Clothing">Clothing</option>
                         <option value="Books">Books</option>
                         <option value="Home">Home & Garden</option>
                     </select>
                 </div>
                 <div class="form-group">
                     <label for="minPrice">Min Price ($)</label>
                     <input type="number" id="minPrice" min="0" step="0.01">
                 </div>
                 <div class="form-group">
                     <label for="maxPrice">Max Price ($)</label>
                     <input type="number" id="maxPrice" min="0" step="0.01">
                 </div>
                 <div class="form-group">
                     <label for="sortBy">Sort By</label>
                     <select id="sortBy">
                         <option value="createdAt">Newest First</option>
                         <option value="price">Price: Low to High</option>
                         <option value="-price">Price: High to Low</option>
                         <option value="name">Name: A to Z</option>
                         <option value="-name">Name: Z to A</option>
                     </select>
                 </div>
                 <button type="submit" class="btn">Search Products</button>
             </form>
         </div>
     </div>

     <!-- Wishlist Modal -->
     <div id="wishlistModal" class="modal">
         <div class="modal-content" style="max-width: 800px;">
             <span class="close" onclick="closeModal('wishlistModal')">&times;</span>
             <h2>My Wishlist</h2>
             <div id="wishlistContent">
                 <div class="loading" id="wishlistLoading">
                     <div class="spinner"></div>
                 </div>
                 <div id="wishlistItems"></div>
             </div>
         </div>
     </div>

    <!-- Payment Modal Part 1: Order Summary & Payment Method -->
    <div id="paymentModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('paymentModal')">&times;</span>
            <h2>Complete Payment</h2>
            <div id="paymentContent">
                <div class="payment-summary">
                    <h3>Order Summary</h3>
                    <div id="paymentOrderDetails"></div>
                    <div class="payment-total">
                        <strong>Total: <span id="paymentTotal">$0.00</span></strong>
                    </div>
                </div>
                
                <div class="payment-method-selection">
                    <h3>Select Payment Method</h3>
                    <div class="payment-methods">
                        <div class="payment-method-option">
                            <input type="radio" id="creditCard" name="paymentMethod" value="creditCard" checked>
                            <label for="creditCard">
                                <i class="fas fa-credit-card"></i>
                                Credit/Debit Card
                            </label>
                        </div>
                        <div class="payment-method-option">
                            <input type="radio" id="paypal" name="paymentMethod" value="paypal">
                            <label for="paypal">
                                <i class="fab fa-paypal"></i>
                                PayPal
                            </label>
                        </div>
                        <div class="payment-method-option">
                            <input type="radio" id="bankTransfer" name="paymentMethod" value="bankTransfer">
                            <label for="bankTransfer">
                                <i class="fas fa-university"></i>
                                Bank Transfer
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="payment-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('paymentModal')">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="proceedToPaymentDetails()">Continue</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Modal Part 2: Payment Details Form -->
    <div id="paymentDetailsModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <span class="close" onclick="closeModal('paymentDetailsModal')">&times;</span>
            <h2>Payment Details</h2>
            <div id="paymentDetailsContent">
                <div class="payment-method-info">
                    <h3>Selected Payment Method</h3>
                    <div id="selectedPaymentMethod"></div>
                </div>
                
                <form id="paymentForm">
                    <div class="form-group">
                        <label for="cardNumber">Card Number</label>
                        <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" maxlength="19" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="expiryDate">Expiry Date</label>
                            <input type="text" id="expiryDate" placeholder="MM/YY" maxlength="5" required>
                        </div>
                        <div class="form-group">
                            <label for="cvv">CVV</label>
                            <input type="text" id="cvv" placeholder="123" maxlength="3" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="cardholderName">Cardholder Name</label>
                        <input type="text" id="cardholderName" placeholder="John Doe" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="billingAddress">Billing Address</label>
                        <textarea id="billingAddress" placeholder="Enter your billing address" rows="3" required></textarea>
                    </div>
                    
                    <div class="payment-actions">
                        <button type="button" class="btn btn-secondary" onclick="goBackToPaymentMethod()">Back</button>
                        <button type="submit" class="btn btn-primary">Pay Now</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

     <!-- Notifications -->
     <div id="notificationContainer" style="position: fixed; top: 20px; right: 20px; z-index: 3000;"></div>

    <script>
         // Global variables
         let currentUser = null;
         let authToken = localStorage.getItem('authToken');
         const API_BASE_URL = 'http://localhost:3000/api';
         let wishlist = JSON.parse(localStorage.getItem('wishlist') || '[]');
         let notifications = [];

         // Initialize the dashboard
         document.addEventListener('DOMContentLoaded', function() {
             initializeDashboard();
             checkAuthStatus();
             loadDashboardStats();
             loadFeaturedProducts();
             updateWishlistUI();
             loadCartCount();
             
             // Add advanced search form handler
             document.getElementById('advancedSearchForm').addEventListener('submit', function(e) {
                 e.preventDefault();
                 performAdvancedSearch();
             });

             // Add payment form handler
             document.getElementById('paymentForm').addEventListener('submit', function(e) {
                 e.preventDefault();
                 processPayment();
             });

             // Add input formatting for payment form
             setupPaymentFormFormatting();
         });

        // Initialize dashboard
        function initializeDashboard() {
            // Set up event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('registerForm').addEventListener('submit', handleRegister);
            document.getElementById('searchInput').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    searchProducts();
                }
            });
        }

        // Check authentication status
        function checkAuthStatus() {
            if (authToken) {
                fetchUserProfile();
            } else {
                updateAuthUI(false);
            }
        }

        // Fetch user profile
        async function fetchUserProfile() {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/me`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    currentUser = data.data.user;
                    updateAuthUI(true);
                } else {
                    localStorage.removeItem('authToken');
                    authToken = null;
                    updateAuthUI(false);
                }
            } catch (error) {
                console.error('Error fetching user profile:', error);
                localStorage.removeItem('authToken');
                authToken = null;
                updateAuthUI(false);
            }
        }

         // Update authentication UI
         function updateAuthUI(isLoggedIn) {
             const greetingElement = document.getElementById('user-greeting');
             const userProfileSection = document.getElementById('userProfileSection');
             const adminProfileSection = document.getElementById('adminProfileSection');
             const heroSection = document.getElementById('heroSection');
             const adminBtn = document.getElementById('adminBtn');
             const adminNavItem = document.getElementById('adminNavItem');
             
             if (isLoggedIn && currentUser) {
                 greetingElement.textContent = `Hello, ${currentUser.name}`;
                 greetingElement.style.cursor = 'pointer';
                 greetingElement.onclick = logout;
                 
                 // Hide hero section and show appropriate profile section
                 heroSection.style.display = 'none';
                 
                 if (currentUser.role === 'ADMIN') {
                     // Show admin profile section
                     adminProfileSection.style.display = 'block';
                     userProfileSection.style.display = 'none';
                     
                     // Show admin button in header
                     adminBtn.style.display = 'flex';
                     adminNavItem.style.display = 'block';
                     
                     // Update admin profile info
                     document.getElementById('adminName').textContent = `Welcome, ${currentUser.name}`;
                     document.getElementById('adminEmail').textContent = currentUser.email;
                 } else {
                     // Show user profile section
                     userProfileSection.style.display = 'block';
                     adminProfileSection.style.display = 'none';
                     
                     // Hide admin button in header
                     adminBtn.style.display = 'none';
                     adminNavItem.style.display = 'none';
                     
                     // Update user profile info
                     document.getElementById('userName').textContent = `Welcome, ${currentUser.name}`;
                     document.getElementById('userEmail').textContent = currentUser.email;
                     document.getElementById('userRole').textContent = currentUser.role;
                 }
             } else {
                 greetingElement.textContent = 'Hello, Sign in';
                 greetingElement.style.cursor = 'pointer';
                 greetingElement.onclick = showLoginModal;
                 
                 // Show hero section and hide profile sections
                 heroSection.style.display = 'block';
                 userProfileSection.style.display = 'none';
                 adminProfileSection.style.display = 'none';
                 
                 // Hide admin elements
                 adminBtn.style.display = 'none';
                 adminNavItem.style.display = 'none';
             }
         }

         // Load dashboard statistics
         async function loadDashboardStats() {
             try {
                 // Try to get stats with auth token, fallback to public if not available
                 const headers = {};
                 if (authToken) {
                     headers['Authorization'] = `Bearer ${authToken}`;
                 }

                 const response = await fetch(`${API_BASE_URL}/admin/dashboard`, {
                     headers: headers
                 });

                 if (response.ok) {
                     const data = await response.json();
                     const stats = data.data.statistics;
                     
                     document.getElementById('totalProducts').textContent = stats.totalProducts || 0;
                     document.getElementById('totalUsers').textContent = stats.totalUsers || 0;
                     document.getElementById('totalOrders').textContent = stats.totalOrders || 0;
                     document.getElementById('totalRevenue').textContent = `$${(stats.totalRevenue || 0).toLocaleString()}`;
                 } else {
                     // Fallback: Load basic stats from products API
                     await loadBasicStats();
                 }
             } catch (error) {
                 console.error('Error loading dashboard stats:', error);
                 // Fallback: Load basic stats from products API
                 await loadBasicStats();
             }
         }

         // Load basic statistics (fallback)
         async function loadBasicStats() {
             try {
                 // Get product count
                 const productsResponse = await fetch(`${API_BASE_URL}/products?page=1&limit=1`);
                 if (productsResponse.ok) {
                     const productsData = await productsResponse.json();
                     document.getElementById('totalProducts').textContent = productsData.data.pagination?.totalItems || 0;
                 }
                 
                 // Set default values for other stats
                 document.getElementById('totalUsers').textContent = '0';
                 document.getElementById('totalOrders').textContent = '0';
                 document.getElementById('totalRevenue').textContent = '$0';
             } catch (error) {
                 console.error('Error loading basic stats:', error);
             }
         }

        // Load featured products
        async function loadFeaturedProducts() {
            try {
                document.getElementById('productsLoading').style.display = 'block';
                
                const response = await fetch(`${API_BASE_URL}/products?page=1&limit=8`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayProducts(data.data.products);
                } else {
                    console.error('Error loading products');
                }
            } catch (error) {
                console.error('Error loading products:', error);
            } finally {
                document.getElementById('productsLoading').style.display = 'none';
            }
        }

        // Display products
        function displayProducts(products) {
            const productsGrid = document.getElementById('productsGrid');
            productsGrid.innerHTML = '';

            if (products.length === 0) {
                productsGrid.innerHTML = '<p style="text-align: center; color: #666; grid-column: 1 / -1;">No products found</p>';
                return;
            }

            products.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }

         // Create product card
         function createProductCard(product) {
             const card = document.createElement('div');
             card.className = 'product-card';
             
             const rating = Math.random() * 2 + 3; // Random rating between 3-5
             const reviewCount = Math.floor(Math.random() * 100) + 10;
             
             card.innerHTML = `
                 <div class="product-image" onclick="showProductDetails('${product._id}')">
                     <i class="fas fa-image"></i>
                     <div class="product-overlay">
                         <button class="quick-view-btn" onclick="event.stopPropagation(); showProductDetails('${product._id}')">
                             <i class="fas fa-eye"></i> Quick View
                         </button>
                     </div>
                 </div>
                 <div class="product-info">
                     <h3 class="product-name" onclick="showProductDetails('${product._id}')">${product.name}</h3>
                     <div class="product-price">$${product.price}</div>
                     <div class="product-rating">
                         <div class="stars">
                             ${generateStars(rating)}
                         </div>
                         <span class="rating-text">(${rating.toFixed(1)})</span>
                     </div>
                     <div class="product-actions">
                         <button class="add-to-cart-btn" onclick="addToCart('${product._id}')">
                             <i class="fas fa-shopping-cart"></i> Add to Cart
                         </button>
                         <button class="wishlist-btn" onclick="toggleWishlist('${product._id}')" title="Add to Wishlist">
                             <i class="far fa-heart"></i>
                         </button>
                     </div>
                     <div class="product-stock">
                         ${product.availableStock > 0 ? 
                             `<span class="in-stock"><i class="fas fa-check-circle"></i> In Stock (${product.availableStock})</span>` : 
                             `<span class="out-of-stock"><i class="fas fa-times-circle"></i> Out of Stock</span>`
                         }
                     </div>
                 </div>
             `;
             
             return card;
         }

         // Generate star rating HTML
         function generateStars(rating) {
             let stars = '';
             const fullStars = Math.floor(rating);
             const hasHalfStar = rating % 1 >= 0.5;
             
             for (let i = 0; i < fullStars; i++) {
                 stars += '<i class="fas fa-star"></i>';
             }
             
             if (hasHalfStar) {
                 stars += '<i class="fas fa-star-half-alt"></i>';
             }
             
             const emptyStars = 5 - Math.ceil(rating);
             for (let i = 0; i < emptyStars; i++) {
                 stars += '<i class="far fa-star"></i>';
             }
             
             return stars;
         }

        // Search products
        async function searchProducts() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            if (!searchTerm) return;

            try {
                document.getElementById('productsLoading').style.display = 'block';
                
                const response = await fetch(`${API_BASE_URL}/products?search=${encodeURIComponent(searchTerm)}&page=1&limit=20`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayProducts(data.data.products);
                }
            } catch (error) {
                console.error('Error searching products:', error);
            } finally {
                document.getElementById('productsLoading').style.display = 'none';
            }
        }

        // Filter by category
        async function filterByCategory(category) {
            try {
                document.getElementById('productsLoading').style.display = 'block';
                
                const response = await fetch(`${API_BASE_URL}/products?category=${encodeURIComponent(category)}&page=1&limit=20`);
                
                if (response.ok) {
                    const data = await response.json();
                    displayProducts(data.data.products);
                }
            } catch (error) {
                console.error('Error filtering products:', error);
            } finally {
                document.getElementById('productsLoading').style.display = 'none';
            }
        }

        // Show all products
        async function showAllProducts() {
            await loadFeaturedProducts();
        }

        // Add to cart
        async function addToCart(productId) {
            if (!authToken) {
                showLoginModal();
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/cart/items`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        productId: productId,
                        quantity: 1
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    updateCartCount(data.data.cart.totalItems);
                    showNotification('Item added to cart successfully!', 'success');
                } else {
                    showNotification(data.message || 'Error adding item to cart', 'error');
                    console.error('Cart API Error:', data);
                }
            } catch (error) {
                console.error('Error adding to cart:', error);
                showNotification('Error adding item to cart', 'error');
            }
        }

         // Update cart count
         function updateCartCount(count) {
             document.getElementById('cartCount').textContent = count;
         }

         // Load cart count on page load
         async function loadCartCount() {
             if (!authToken) {
                 updateCartCount(0);
                 return;
             }

             try {
                 const response = await fetch(`${API_BASE_URL}/cart`, {
                     headers: {
                         'Authorization': `Bearer ${authToken}`
                     }
                 });

                 if (response.ok) {
                     const data = await response.json();
                     updateCartCount(data.data.cart.totalItems);
                 } else {
                     updateCartCount(0);
                 }
             } catch (error) {
                 console.error('Error loading cart count:', error);
                 updateCartCount(0);
             }
         }

        // Show cart
        async function showCart() {
            if (!authToken) {
                showLoginModal();
                return;
            }

            document.getElementById('cartModal').style.display = 'block';
            document.getElementById('cartLoading').style.display = 'block';
            document.getElementById('cartItems').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/cart`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayCartItems(data.data.cart);
                } else {
                    document.getElementById('cartItems').innerHTML = '<p>Error loading cart</p>';
                }
            } catch (error) {
                console.error('Error loading cart:', error);
                document.getElementById('cartItems').innerHTML = '<p>Error loading cart</p>';
            } finally {
                document.getElementById('cartLoading').style.display = 'none';
            }
        }

        // Display cart items
        function displayCartItems(cart) {
            const cartItems = document.getElementById('cartItems');
            
            if (cart.items.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #666;">Your cart is empty</p>';
                return;
            }

            let html = '<div style="margin-bottom: 1rem;">';
            cart.items.forEach(item => {
                html += `
                    <div style="display: flex; align-items: center; padding: 1rem; border-bottom: 1px solid #eee;">
                        <div style="flex: 1;">
                            <h4>${item.productName}</h4>
                            <p>$${item.productPrice} x ${item.quantity}</p>
                        </div>
                        <div style="margin: 0 1rem;">
                            <button onclick="updateCartItem('${item.productId}', ${item.quantity - 1})" style="padding: 0.25rem 0.5rem; margin: 0 0.25rem;">-</button>
                            <span>${item.quantity}</span>
                            <button onclick="updateCartItem('${item.productId}', ${item.quantity + 1})" style="padding: 0.25rem 0.5rem; margin: 0 0.25rem;">+</button>
                        </div>
                        <div style="font-weight: 600;">$${item.subtotal}</div>
                        <button onclick="removeFromCart('${item.productId}')" style="margin-left: 1rem; color: #dc3545;">Remove</button>
                    </div>
                `;
            });
            html += '</div>';
            html += `
                <div style="border-top: 2px solid #333; padding-top: 1rem;">
                    <div style="display: flex; justify-content: space-between; font-size: 1.25rem; font-weight: 600;">
                        <span>Total: $${cart.totalAmount}</span>
                        <button class="btn" onclick="proceedToCheckout()">Proceed to Checkout</button>
                    </div>
                </div>
            `;
            
            cartItems.innerHTML = html;
        }

         // Update cart item
         async function updateCartItem(productId, quantity) {
             if (quantity <= 0) {
                 removeFromCart(productId);
                 return;
             }

             try {
                 const response = await fetch(`${API_BASE_URL}/cart/items/${productId}`, {
                     method: 'PUT',
                     headers: {
                         'Content-Type': 'application/json',
                         'Authorization': `Bearer ${authToken}`
                     },
                     body: JSON.stringify({ quantity })
                 });

                 if (response.ok) {
                     const data = await response.json();
                     updateCartCount(data.data.cart.totalItems);
                     showCart(); // Refresh cart
                 } else {
                     const error = await response.json();
                     showNotification(error.message || 'Error updating cart item', 'error');
                 }
             } catch (error) {
                 console.error('Error updating cart item:', error);
                 showNotification('Error updating cart item', 'error');
             }
         }

         // Remove from cart
         async function removeFromCart(productId) {
             try {
                 const response = await fetch(`${API_BASE_URL}/cart/items/${productId}`, {
                     method: 'DELETE',
                     headers: {
                         'Authorization': `Bearer ${authToken}`
                     }
                 });

                 if (response.ok) {
                     const data = await response.json();
                     updateCartCount(data.data.cart.totalItems);
                     showNotification('Item removed from cart', 'success');
                     showCart(); // Refresh cart
                 } else {
                     const error = await response.json();
                     showNotification(error.message || 'Error removing item from cart', 'error');
                 }
             } catch (error) {
                 console.error('Error removing from cart:', error);
                 showNotification('Error removing item from cart', 'error');
             }
         }

        // Proceed to checkout
        async function proceedToCheckout() {
            if (!authToken) {
                showLoginModal();
                return;
            }

            try {
                // First get the cart to show order summary
                const cartResponse = await fetch(`${API_BASE_URL}/cart`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (cartResponse.ok) {
                    const cartData = await cartResponse.json();
                    const cart = cartData.data.cart;
                    
                    // Show payment modal with order details
                    showPaymentModal(cart);
                } else {
                    showNotification('Error loading cart for checkout', 'error');
                }
            } catch (error) {
                console.error('Error loading cart for checkout:', error);
                showNotification('Error loading cart for checkout', 'error');
            }
        }

        // Show payment modal
        function showPaymentModal(cart) {
            document.getElementById('paymentModal').style.display = 'block';
            
            // Display order details
            const orderDetails = document.getElementById('paymentOrderDetails');
            let html = '';
            
            cart.items.forEach(item => {
                html += `
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span>${item.productName} x ${item.quantity}</span>
                        <span>$${item.subtotal}</span>
                    </div>
                `;
            });
            
            orderDetails.innerHTML = html;
            document.getElementById('paymentTotal').textContent = `$${cart.totalAmount}`;
            
            // Store cart data for payment processing
            window.currentCart = cart;
        }

        // Proceed to payment details (Part 2)
        function proceedToPaymentDetails() {
            const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked').value;
            
            // Close first modal and open second modal
            document.getElementById('paymentModal').style.display = 'none';
            document.getElementById('paymentDetailsModal').style.display = 'block';
            
            // Display selected payment method
            const selectedPaymentMethodDiv = document.getElementById('selectedPaymentMethod');
            let methodText = '';
            
            switch(selectedMethod) {
                case 'creditCard':
                    methodText = '<i class="fas fa-credit-card"></i> Credit/Debit Card';
                    break;
                case 'paypal':
                    methodText = '<i class="fab fa-paypal"></i> PayPal';
                    break;
                case 'bankTransfer':
                    methodText = '<i class="fas fa-university"></i> Bank Transfer';
                    break;
            }
            
            selectedPaymentMethodDiv.innerHTML = methodText;
            
            // Store selected payment method
            window.selectedPaymentMethod = selectedMethod;
        }

        // Go back to payment method selection (Part 1)
        function goBackToPaymentMethod() {
            document.getElementById('paymentDetailsModal').style.display = 'none';
            document.getElementById('paymentModal').style.display = 'block';
        }

        // Process payment
        async function processPayment() {
            if (!authToken || !window.currentCart) {
                showNotification('Payment session expired', 'error');
                return;
            }

            try {
                // Create order first
                const orderResponse = await fetch(`${API_BASE_URL}/orders/checkout`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        shippingAddress: {
                            street: document.getElementById('billingAddress').value.split('\n')[0] || '123 Main St',
                            city: 'Anytown',
                            state: 'CA',
                            zipCode: '12345',
                            country: 'USA'
                        },
                        paymentMethod: 'CREDIT_CARD',
                        notes: 'Payment processed via dashboard'
                    })
                });

                if (orderResponse.ok) {
                    const orderData = await orderResponse.json();
                    const orderId = orderData.data.order._id;
                    
                    // Process payment
                    const paymentResponse = await fetch(`${API_BASE_URL}/orders/${orderId}/pay`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${authToken}`
                        },
                        body: JSON.stringify({
                            paymentMethod: 'CREDIT_CARD',
                            amount: window.currentCart.totalAmount,
                            cardDetails: {
                                number: document.getElementById('cardNumber').value,
                                expiry: document.getElementById('expiryDate').value,
                                cvv: document.getElementById('cvv').value,
                                name: document.getElementById('cardholderName').value
                            }
                        })
                    });

                    if (paymentResponse.ok) {
                        const paymentData = await paymentResponse.json();
                        showNotification('Payment successful! Order placed.', 'success');
                        closeModal('paymentModal');
                        closeModal('cartModal');
                        showOrders();
                        loadCartCount(); // Refresh cart count
                    } else {
                        const error = await paymentResponse.json();
                        showNotification(error.message || 'Payment failed', 'error');
                    }
                } else {
                    const error = await orderResponse.json();
                    showNotification(error.message || 'Error creating order', 'error');
                }
            } catch (error) {
                console.error('Error processing payment:', error);
                showNotification('Error processing payment', 'error');
            }
        }

        // Show orders
        async function showOrders() {
            if (!authToken) {
                showLoginModal();
                return;
            }

            document.getElementById('ordersModal').style.display = 'block';
            document.getElementById('ordersLoading').style.display = 'block';
            document.getElementById('ordersList').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/orders?page=1&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayOrders(data.data.orders);
                } else {
                    document.getElementById('ordersList').innerHTML = '<p>Error loading orders</p>';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('ordersList').innerHTML = '<p>Error loading orders</p>';
            } finally {
                document.getElementById('ordersLoading').style.display = 'none';
            }
        }

        // Display orders
        function displayOrders(orders) {
            const ordersList = document.getElementById('ordersList');
            
            if (orders.length === 0) {
                ordersList.innerHTML = '<p style="text-align: center; color: #666;">No orders found</p>';
                return;
            }

            let html = '';
            orders.forEach(order => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem;">
                            <h4>Order #${order.orderNumber}</h4>
                            <span style="padding: 0.25rem 0.75rem; border-radius: 4px; background: #e9ecef; color: #495057;">${order.status}</span>
                        </div>
                        <p><strong>Total:</strong> $${order.totalAmount}</p>
                        <p><strong>Date:</strong> ${new Date(order.createdAt).toLocaleDateString()}</p>
                        <p><strong>Items:</strong> ${order.items.length}</p>
                    </div>
                `;
            });
            
            ordersList.innerHTML = html;
        }

         // Show admin panel
         async function showAdminPanel() {
             if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                 showNotification('Admin access required', 'error');
                 return;
             }

            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminLoading').style.display = 'block';
            document.getElementById('adminDashboard').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/admin/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayAdminDashboard(data.data);
                } else {
                    document.getElementById('adminDashboard').innerHTML = '<p>Error loading admin dashboard</p>';
                }
            } catch (error) {
                console.error('Error loading admin dashboard:', error);
                document.getElementById('adminDashboard').innerHTML = '<p>Error loading admin dashboard</p>';
            } finally {
                document.getElementById('adminLoading').style.display = 'none';
            }
        }

        // Display admin dashboard
        function displayAdminDashboard(data) {
            const adminDashboard = document.getElementById('adminDashboard');
            
            let html = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3>${data.statistics.totalOrders}</h3>
                        <p>Total Orders</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3>${data.statistics.totalUsers}</h3>
                        <p>Total Users</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3>${data.statistics.totalProducts}</h3>
                        <p>Total Products</p>
                    </div>
                    <div style="background: #f8f9fa; padding: 1rem; border-radius: 8px; text-align: center;">
                        <h3>$${data.statistics.totalRevenue.toLocaleString()}</h3>
                        <p>Total Revenue</p>
                    </div>
                </div>
                
                <!-- Admin Actions -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                    <button class="btn btn-primary" onclick="showAddProductModal()" style="padding: 1rem; font-size: 1rem;">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                    <button class="btn btn-secondary" onclick="showAllOrders()" style="padding: 1rem; font-size: 1rem;">
                        <i class="fas fa-box"></i> Manage Orders
                    </button>
                    <button class="btn btn-secondary" onclick="showAllUsers()" style="padding: 1rem; font-size: 1rem;">
                        <i class="fas fa-users"></i> Manage Users
                    </button>
                    <button class="btn btn-secondary" onclick="showAllProductsAdmin()" style="padding: 1rem; font-size: 1rem;">
                        <i class="fas fa-shopping-bag"></i> Manage Products
                    </button>
                </div>
                
                <h3>Recent Orders</h3>
                <div style="margin-top: 1rem;">
            `;
            
            data.recentOrders.forEach(order => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <h4>Order #${order.orderNumber}</h4>
                                <p>Customer: ${order.userId.name}</p>
                                <p>Amount: $${order.totalAmount}</p>
                            </div>
                            <span style="padding: 0.25rem 0.75rem; border-radius: 4px; background: #e9ecef; color: #495057;">${order.status}</span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            adminDashboard.innerHTML = html;
        }

        // Show add product modal
        function showAddProductModal() {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }
            document.getElementById('addProductModal').style.display = 'block';
        }

        // Handle add product form submission
        async function handleAddProduct(e) {
            e.preventDefault();
            
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            const formData = new FormData(e.target);
            const productData = {
                name: formData.get('name'),
                description: formData.get('description'),
                price: parseFloat(formData.get('price')),
                stock: parseInt(formData.get('stock')),
                category: formData.get('category'),
                imageUrl: formData.get('imageUrl') || '',
                brand: formData.get('brand') || '',
                weight: formData.get('weight') ? parseFloat(formData.get('weight')) : undefined,
                dimensions: formData.get('dimensions') || ''
            };

            try {
                const response = await fetch(`${API_BASE_URL}/products`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(productData)
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification('Product added successfully!', 'success');
                    closeModal('addProductModal');
                    e.target.reset();
                    // Refresh the admin dashboard
                    showAdminPanel();
                } else {
                    showNotification(data.message || 'Failed to add product', 'error');
                }
            } catch (error) {
                console.error('Error adding product:', error);
                showNotification('Error adding product', 'error');
            }
        }

        // Show all products for admin management
        async function showAllProductsAdmin() {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminLoading').style.display = 'block';
            document.getElementById('adminDashboard').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/admin/products?page=1&limit=20`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayAdminProducts(data.data);
                } else {
                    document.getElementById('adminDashboard').innerHTML = '<p>Error loading products</p>';
                }
            } catch (error) {
                console.error('Error loading products:', error);
                document.getElementById('adminDashboard').innerHTML = '<p>Error loading products</p>';
            } finally {
                document.getElementById('adminLoading').style.display = 'none';
            }
        }

        // Display admin products
        function displayAdminProducts(data) {
            const adminDashboard = document.getElementById('adminDashboard');
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>Manage Products</h2>
                    <button class="btn btn-primary" onclick="showAddProductModal()">
                        <i class="fas fa-plus"></i> Add New Product
                    </button>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
            `;
            
            data.products.forEach(product => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <h4 style="margin: 0;">${product.name}</h4>
                            <div style="display: flex; gap: 0.5rem;">
                                <button class="btn btn-sm btn-secondary" onclick="editProduct('${product._id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn btn-sm btn-danger" onclick="deleteProduct('${product._id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p style="color: #666; margin-bottom: 0.5rem;">${product.description}</p>
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <span style="font-weight: bold; color: #b12704;">$${product.price}</span>
                            <span style="color: ${product.stock > 0 ? '#28a745' : '#dc3545'};">
                                Stock: ${product.stock}
                            </span>
                        </div>
                        <div style="margin-top: 0.5rem;">
                            <span style="background: #e9ecef; padding: 0.25rem 0.5rem; border-radius: 4px; font-size: 0.875rem;">
                                ${product.category}
                            </span>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            
            // Add pagination if needed
            if (data.pagination.totalPages > 1) {
                html += `
                    <div style="display: flex; justify-content: center; margin-top: 2rem;">
                        <div style="display: flex; gap: 0.5rem;">
                `;
                
                for (let i = 1; i <= Math.min(data.pagination.totalPages, 5); i++) {
                    html += `<button class="btn btn-sm btn-secondary" onclick="loadAdminProductsPage(${i})">${i}</button>`;
                }
                
                html += '</div></div>';
            }
            
            adminDashboard.innerHTML = html;
        }

        // Edit product function
        async function editProduct(productId) {
            // This would open an edit modal - for now, just show a notification
            showNotification('Edit functionality coming soon!', 'info');
        }

        // Delete product function
        async function deleteProduct(productId) {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            if (!confirm('Are you sure you want to delete this product?')) {
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}`, {
                    method: 'DELETE',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification('Product deleted successfully!', 'success');
                    showAllProductsAdmin(); // Refresh the list
                } else {
                    showNotification(data.message || 'Failed to delete product', 'error');
                }
            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('Error deleting product', 'error');
            }
        }

        // Show all orders for admin
        async function showAllOrders() {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminLoading').style.display = 'block';
            document.getElementById('adminDashboard').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/admin/orders?page=1&limit=20`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayAdminOrders(data.data);
                } else {
                    document.getElementById('adminDashboard').innerHTML = '<p>Error loading orders</p>';
                }
            } catch (error) {
                console.error('Error loading orders:', error);
                document.getElementById('adminDashboard').innerHTML = '<p>Error loading orders</p>';
            } finally {
                document.getElementById('adminLoading').style.display = 'none';
            }
        }

        // Display admin orders
        function displayAdminOrders(data) {
            const adminDashboard = document.getElementById('adminDashboard');
            
            let html = `
                <h2>Manage Orders</h2>
                <div style="display: flex; flex-direction: column; gap: 1rem;">
            `;
            
            data.orders.forEach(order => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h4 style="margin: 0;">Order #${order.orderNumber}</h4>
                                <p style="margin: 0.25rem 0; color: #666;">Customer: ${order.userId.name} (${order.userId.email})</p>
                                <p style="margin: 0.25rem 0; color: #666;">Date: ${new Date(order.createdAt).toLocaleDateString()}</p>
                            </div>
                            <div style="display: flex; flex-direction: column; align-items: end; gap: 0.5rem;">
                                <span style="padding: 0.25rem 0.75rem; border-radius: 4px; background: #e9ecef; color: #495057;">${order.status}</span>
                                <span style="font-weight: bold; color: #b12704;">$${order.totalAmount}</span>
                            </div>
                        </div>
                        <div style="margin-top: 1rem;">
                            <h5>Items:</h5>
                            <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                `;
                
                order.items.forEach(item => {
                    html += `
                        <div style="display: flex; justify-content: space-between; padding: 0.5rem; background: #f8f9fa; border-radius: 4px;">
                            <span>${item.productId.name}</span>
                            <span>Qty: ${item.quantity} × $${item.priceAtPurchase}</span>
                        </div>
                    `;
                });
                
                html += `
                            </div>
                        </div>
                        <div style="margin-top: 1rem; display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-primary" onclick="updateOrderStatus('${order._id}', 'SHIPPED')" ${order.status !== 'PAID' ? 'disabled' : ''}>
                                Mark as Shipped
                            </button>
                            <button class="btn btn-sm btn-success" onclick="updateOrderStatus('${order._id}', 'DELIVERED')" ${order.status !== 'SHIPPED' ? 'disabled' : ''}>
                                Mark as Delivered
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            adminDashboard.innerHTML = html;
        }

        // Update order status
        async function updateOrderStatus(orderId, status) {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/orders/${orderId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ status })
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification(`Order status updated to ${status}`, 'success');
                    showAllOrders(); // Refresh the list
                } else {
                    showNotification(data.message || 'Failed to update order status', 'error');
                }
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('Error updating order status', 'error');
            }
        }

        // Show all users for admin
        async function showAllUsers() {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            document.getElementById('adminModal').style.display = 'block';
            document.getElementById('adminLoading').style.display = 'block';
            document.getElementById('adminDashboard').innerHTML = '';

            try {
                const response = await fetch(`${API_BASE_URL}/admin/users?page=1&limit=20`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    displayAdminUsers(data.data);
                } else {
                    document.getElementById('adminDashboard').innerHTML = '<p>Error loading users</p>';
                }
            } catch (error) {
                console.error('Error loading users:', error);
                document.getElementById('adminDashboard').innerHTML = '<p>Error loading users</p>';
            } finally {
                document.getElementById('adminLoading').style.display = 'none';
            }
        }

        // Display admin users
        function displayAdminUsers(data) {
            const adminDashboard = document.getElementById('adminDashboard');
            
            let html = `
                <h2>Manage Users</h2>
                <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1rem;">
            `;
            
            data.users.forEach(user => {
                html += `
                    <div style="border: 1px solid #ddd; border-radius: 8px; padding: 1rem; background: white;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <div>
                                <h4 style="margin: 0;">${user.name}</h4>
                                <p style="margin: 0.25rem 0; color: #666;">${user.email}</p>
                                <p style="margin: 0.25rem 0; color: #666;">Joined: ${new Date(user.createdAt).toLocaleDateString()}</p>
                            </div>
                            <span style="padding: 0.25rem 0.75rem; border-radius: 4px; background: ${user.role === 'ADMIN' ? '#ffebee' : '#e3f2fd'}; color: ${user.role === 'ADMIN' ? '#d32f2f' : '#1976d2'};">
                                ${user.role}
                            </span>
                        </div>
                        <div style="display: flex; gap: 0.5rem;">
                            <button class="btn btn-sm btn-secondary" onclick="toggleUserStatus('${user._id}', ${user.isActive})">
                                ${user.isActive ? 'Deactivate' : 'Activate'}
                            </button>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            adminDashboard.innerHTML = html;
        }

        // Toggle user status
        async function toggleUserStatus(userId, currentStatus) {
            if (!authToken || !currentUser || currentUser.role !== 'ADMIN') {
                showNotification('Admin access required', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_BASE_URL}/admin/users/${userId}/status`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ isActive: !currentStatus })
                });

                const data = await response.json();

                if (response.ok) {
                    showNotification(`User ${!currentStatus ? 'activated' : 'deactivated'} successfully`, 'success');
                    showAllUsers(); // Refresh the list
                } else {
                    showNotification(data.message || 'Failed to update user status', 'error');
                }
            } catch (error) {
                console.error('Error updating user status:', error);
                showNotification('Error updating user status', 'error');
            }
        }

        // Handle login
        async function handleLogin(e) {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                 if (response.ok) {
                     authToken = data.data.token;
                     localStorage.setItem('authToken', authToken);
                     currentUser = data.data.user;
                     updateAuthUI(true);
                     closeModal('loginModal');
                     showNotification('Login successful!', 'success');
                     loadDashboardStats();
                 } else {
                     showNotification(data.message || 'Login failed', 'error');
                 }
             } catch (error) {
                 console.error('Login error:', error);
                 showNotification('Login failed', 'error');
             }
        }

        // Handle register
        async function handleRegister(e) {
            e.preventDefault();
            
            const name = document.getElementById('registerName').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const role = document.getElementById('registerRole').value;

            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name, email, password, role })
                });

                const data = await response.json();

                 if (response.ok) {
                     authToken = data.data.token;
                     localStorage.setItem('authToken', authToken);
                     currentUser = data.data.user;
                     updateAuthUI(true);
                     closeModal('registerModal');
                     showNotification('Registration successful!', 'success');
                     loadDashboardStats();
                 } else {
                     showNotification(data.message || 'Registration failed', 'error');
                 }
             } catch (error) {
                 console.error('Registration error:', error);
                 showNotification('Registration failed', 'error');
             }
        }

         // Logout
         function logout() {
             localStorage.removeItem('authToken');
             authToken = null;
             currentUser = null;
             updateAuthUI(false);
             showNotification('Logged out successfully', 'success');
         }

        // Modal functions
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
            document.getElementById('registerModal').style.display = 'none';
        }

        function showRegisterModal() {
            document.getElementById('registerModal').style.display = 'block';
            document.getElementById('loginModal').style.display = 'none';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Show alert
        function showAlert(message, type) {
            const alertElement = document.getElementById(type === 'success' ? 'loginSuccess' : 'loginError');
            alertElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 3000);
        }

         // Show product details
         async function showProductDetails(productId) {
             document.getElementById('productModal').style.display = 'block';
             document.getElementById('productLoading').style.display = 'block';
             document.getElementById('productContent').innerHTML = '';

             try {
                 const response = await fetch(`${API_BASE_URL}/products/${productId}`);
                 
                 if (response.ok) {
                     const data = await response.json();
                     const product = data.data.product;
                     displayProductDetails(product);
                 } else {
                     document.getElementById('productContent').innerHTML = '<p>Error loading product details</p>';
                 }
             } catch (error) {
                 console.error('Error loading product details:', error);
                 document.getElementById('productContent').innerHTML = '<p>Error loading product details</p>';
             } finally {
                 document.getElementById('productLoading').style.display = 'none';
             }
         }

         // Display product details
         function displayProductDetails(product) {
             const rating = Math.random() * 2 + 3;
             const reviewCount = Math.floor(Math.random() * 100) + 10;
             
             const productContent = document.getElementById('productContent');
             productContent.innerHTML = `
                 <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                     <div>
                         <div style="width: 100%; height: 300px; background: #f8f9fa; display: flex; align-items: center; justify-content: center; font-size: 4rem; color: #666; border-radius: 8px;">
                             <i class="fas fa-image"></i>
                         </div>
                     </div>
                     <div>
                         <h2 style="margin-bottom: 1rem;">${product.name}</h2>
                         <div style="font-size: 2rem; font-weight: 700; color: #b12704; margin-bottom: 1rem;">$${product.price}</div>
                         <div style="margin-bottom: 1rem;">
                             <div class="stars" style="margin-bottom: 0.5rem;">
                                 ${generateStars(rating)}
                             </div>
                             <span style="color: #666;">${rating.toFixed(1)} out of 5 (${reviewCount} reviews)</span>
                         </div>
                         <div style="margin-bottom: 1rem;">
                             <strong>Description:</strong>
                             <p style="margin-top: 0.5rem; line-height: 1.6;">${product.description}</p>
                         </div>
                         <div style="margin-bottom: 1rem;">
                             <strong>Category:</strong> ${product.category || 'N/A'}
                         </div>
                         <div style="margin-bottom: 1rem;">
                             <strong>Stock:</strong> 
                             ${product.availableStock > 0 ? 
                                 `<span style="color: #28a745;">In Stock (${product.availableStock} available)</span>` : 
                                 `<span style="color: #dc3545;">Out of Stock</span>`
                             }
                         </div>
                         <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                             <button class="btn" onclick="addToCart('${product._id}')" style="flex: 1;">
                                 <i class="fas fa-shopping-cart"></i> Add to Cart
                             </button>
                             <button class="wishlist-btn" onclick="toggleWishlist('${product._id}')" style="padding: 0.75rem 1rem;">
                                 <i class="far fa-heart"></i>
                             </button>
                         </div>
                     </div>
                 </div>
             `;
         }

         // Toggle wishlist
         function toggleWishlist(productId) {
             if (!authToken) {
                 showLoginModal();
                 return;
             }

             const index = wishlist.indexOf(productId);
             if (index > -1) {
                 wishlist.splice(index, 1);
                 showNotification('Removed from wishlist', 'info');
             } else {
                 wishlist.push(productId);
                 showNotification('Added to wishlist', 'success');
             }
             
             localStorage.setItem('wishlist', JSON.stringify(wishlist));
             updateWishlistUI();
         }

         // Update wishlist UI
         function updateWishlistUI() {
             const wishlistButtons = document.querySelectorAll('.wishlist-btn');
             wishlistButtons.forEach(btn => {
                 const productId = btn.onclick.toString().match(/'([^']+)'/)[1];
                 if (wishlist.includes(productId)) {
                     btn.classList.add('active');
                     btn.innerHTML = '<i class="fas fa-heart"></i>';
                 } else {
                     btn.classList.remove('active');
                     btn.innerHTML = '<i class="far fa-heart"></i>';
                 }
             });
             
             // Update wishlist count in header
             document.getElementById('wishlistCount').textContent = wishlist.length;
         }

         // Show wishlist
         async function showWishlist() {
             if (!authToken) {
                 showLoginModal();
                 return;
             }

             document.getElementById('wishlistModal').style.display = 'block';
             document.getElementById('wishlistLoading').style.display = 'block';
             document.getElementById('wishlistItems').innerHTML = '';

             try {
                 const wishlistProducts = [];
                 for (const productId of wishlist) {
                     const response = await fetch(`${API_BASE_URL}/products/${productId}`);
                     if (response.ok) {
                         const data = await response.json();
                         wishlistProducts.push(data.data.product);
                     }
                 }
                 displayWishlistItems(wishlistProducts);
             } catch (error) {
                 console.error('Error loading wishlist:', error);
                 document.getElementById('wishlistItems').innerHTML = '<p>Error loading wishlist</p>';
             } finally {
                 document.getElementById('wishlistLoading').style.display = 'none';
             }
         }

         // Display wishlist items
         function displayWishlistItems(products) {
             const wishlistItems = document.getElementById('wishlistItems');
             
             if (products.length === 0) {
                 wishlistItems.innerHTML = '<p style="text-align: center; color: #666;">Your wishlist is empty</p>';
                 return;
             }

             let html = '<div class="products-grid">';
             products.forEach(product => {
                 const rating = Math.random() * 2 + 3;
                 html += `
                     <div class="product-card">
                         <div class="product-image" onclick="showProductDetails('${product._id}')">
                             <i class="fas fa-image"></i>
                         </div>
                         <div class="product-info">
                             <h3 class="product-name" onclick="showProductDetails('${product._id}')">${product.name}</h3>
                             <div class="product-price">$${product.price}</div>
                             <div class="product-rating">
                                 <div class="stars">${generateStars(rating)}</div>
                                 <span class="rating-text">(${rating.toFixed(1)})</span>
                             </div>
                             <div class="product-actions">
                                 <button class="add-to-cart-btn" onclick="addToCart('${product._id}')">
                                     <i class="fas fa-shopping-cart"></i> Add to Cart
                                 </button>
                                 <button class="wishlist-btn active" onclick="toggleWishlist('${product._id}')">
                                     <i class="fas fa-heart"></i>
                                 </button>
                             </div>
                         </div>
                     </div>
                 `;
             });
             html += '</div>';
             wishlistItems.innerHTML = html;
         }

         // Advanced search
         async function performAdvancedSearch() {
             const searchTerm = document.getElementById('searchTerm').value;
             const category = document.getElementById('searchCategory').value;
             const minPrice = document.getElementById('minPrice').value;
             const maxPrice = document.getElementById('maxPrice').value;
             const sortBy = document.getElementById('sortBy').value;

             let queryParams = [];
             if (searchTerm) queryParams.push(`search=${encodeURIComponent(searchTerm)}`);
             if (category) queryParams.push(`category=${encodeURIComponent(category)}`);
             if (minPrice) queryParams.push(`minPrice=${minPrice}`);
             if (maxPrice) queryParams.push(`maxPrice=${maxPrice}`);
             if (sortBy) {
                 const [field, order] = sortBy.startsWith('-') ? [sortBy.substring(1), 'desc'] : [sortBy, 'asc'];
                 queryParams.push(`sort=${field}&order=${order}`);
             }

             const queryString = queryParams.length > 0 ? '?' + queryParams.join('&') : '';
             
             try {
                 document.getElementById('productsLoading').style.display = 'block';
                 
                 const response = await fetch(`${API_BASE_URL}/products${queryString}&page=1&limit=20`);
                 
                 if (response.ok) {
                     const data = await response.json();
                     displayProducts(data.data.products);
                     closeModal('searchModal');
                 }
             } catch (error) {
                 console.error('Error searching products:', error);
             } finally {
                 document.getElementById('productsLoading').style.display = 'none';
             }
         }

         // Show notification
         function showNotification(message, type = 'info') {
             const notification = document.createElement('div');
             notification.className = `notification notification-${type}`;
             notification.style.cssText = `
                 background: ${type === 'success' ? '#d4edda' : type === 'error' ? '#f8d7da' : '#d1ecf1'};
                 color: ${type === 'success' ? '#155724' : type === 'error' ? '#721c24' : '#0c5460'};
                 padding: 1rem;
                 border-radius: 4px;
                 margin-bottom: 0.5rem;
                 box-shadow: 0 2px 8px rgba(0,0,0,0.1);
                 animation: slideIn 0.3s ease;
             `;
             notification.innerHTML = `
                 <div style="display: flex; justify-content: space-between; align-items: center;">
                     <span>${message}</span>
                     <button onclick="this.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 1.2rem; cursor: pointer;">&times;</button>
                 </div>
             `;
             
             document.getElementById('notificationContainer').appendChild(notification);
             
             setTimeout(() => {
                 if (notification.parentElement) {
                     notification.remove();
                 }
             }, 5000);
         }

         // Add CSS for notifications
         const notificationCSS = `
             @keyframes slideIn {
                 from { transform: translateX(100%); opacity: 0; }
                 to { transform: translateX(0); opacity: 1; }
             }
         `;
         const style = document.createElement('style');
         style.textContent = notificationCSS;
         document.head.appendChild(style);

         // Setup payment form formatting
         function setupPaymentFormFormatting() {
             // Card number formatting
             const cardNumber = document.getElementById('cardNumber');
             cardNumber.addEventListener('input', function(e) {
                 let value = e.target.value.replace(/\s/g, '').replace(/[^0-9]/gi, '');
                 let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                 e.target.value = formattedValue;
             });

             // Expiry date formatting
             const expiryDate = document.getElementById('expiryDate');
             expiryDate.addEventListener('input', function(e) {
                 let value = e.target.value.replace(/\D/g, '');
                 if (value.length >= 2) {
                     value = value.substring(0, 2) + '/' + value.substring(2, 4);
                 }
                 e.target.value = value;
             });

             // CVV formatting (numbers only)
             const cvv = document.getElementById('cvv');
             cvv.addEventListener('input', function(e) {
                 e.target.value = e.target.value.replace(/[^0-9]/g, '');
             });

             // Cardholder name formatting (letters and spaces only)
             const cardholderName = document.getElementById('cardholderName');
             cardholderName.addEventListener('input', function(e) {
                 e.target.value = e.target.value.replace(/[^a-zA-Z\s]/g, '');
             });
         }
    </script>
</body>
</html>
